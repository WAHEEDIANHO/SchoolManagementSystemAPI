apiVersion: apps/v1
kind: Deployment
metadata: 
    name: sms-auth-mssql-depl
spec:
    replicas: 1
    selector:
        matchLabels: 
            app: sms-auth-mssql
    template:
        metadata:
            labels:
                app: sms-auth-mssql
        spec:
            containers:
                - name: sms-auth-mssql
                  # image: mcr.microsoft.com/mssql/server:2017-latest
                  image: mcr.microsoft.com/mssql/server:latest
                  ports:
                    - containerPort: 1433
                  env:
                    - name: MSSQL_PID
                      value: "Express"
                    - name: ACCEPT_EULA
                      value: "Y"
                    - name: SA_PASSWORD
                      valueFrom:
                        secretKeyRef:
                            name: mssql
                            key: SA_PASSWORD
                  volumeMounts:
                    - mountPath: /var/opt/mssql/data
                      name: mssqldb
            volumes:
                - name: mssqldb
                  persistentVolumeClaim:
                    claimName: sms-mssql-claim
---
apiVersion: v1
kind: Service
metadata: 
    name: sms-auth-mssql-srv
spec:
    type: ClusterIP
    selector:   
        app: sms-auth-mssql
    ports:
        - name: sms-auth-mssql
          protocol: TCP
          port: 1433
          targetPort: 1433
---
apiVersion: v1
kind: Service
metadata: 
    name: sms-auth-loadbalancer
spec:
    type: LoadBalancer
    selector:   
        app: sms-auth-mssql
    ports:
        - protocol: TCP
          port: 1433
          targetPort: 1433
